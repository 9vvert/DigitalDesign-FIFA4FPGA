# 小记
大二下学期的数字逻辑设计恐怕将成为我整个大学生涯最“难忘”的一门课了，下半个学期几乎是整天泡在那个空旷的实验室，调试沟槽的verilog，看《赌博默示录》和《nana》.
虽然如今看来，当时许多我自认为不错的代码，只能用勾石来形容（）然而还是有一些难忘的瞬间，最近突然想要记录一下。

### 第一次将手柄信号调通
![](/image/01.gif)

这是我整个项目的起点，大概花了一周多的时间才完成。买手柄的配套代码都是关于STM32和arduino，移植花费了我一番功夫。更沟槽的是我感觉配套代码有的地方是错的。
中途最大的问题就是信号经常断，后来自己加了巨量延时才稳定。
那天下午成功后，甚至第一次买了点小酒庆祝. 对未来充满了信心，根本不知道我将要面对什么（

### 古法调试SD卡
![](/image/02.jpg)

![](/image/03.jpg)

![](/image/04.jpg)

感谢助教的配套SD代码，拿来直接抄一抄就能用了。

![](/image/05.gif)

调试用的依然是数码管大法，用手机录制，然后一帧一帧对比hex file,

### 依托答辩的显存
![](/image/06.gif)

![](/image/07.gif)

针对SDRAM搓了一个双显存，大概凌晨三四点编译出来了，花屏给我眼闪瞎了。
试过调整屏幕分辨率，vga时钟频率，等等都没用。一直干到凌晨6点然后开始睡觉。然后发现毛概群里说今天有小测，还是早八，牛魔的。

后来估测了一下SDRAM的数据读写速率发现速度太慢，做不了显存，被迫换SRAM做显存。原先的SDRAM沦为图片资源内存。

![](/image/08.jpg)
终于是稳定下来了，但效果很难评

![](/image/10.jpg)

![](/image/09.jpg)
能读出来小人了，赢

![](/image/11.jpg)

读背景，像加了一层咖喱味的滤镜

![](/image/12.gif)

我承认画面出来的那一瞬间我被气笑了

![](/image/13.jpg)

终于好了

![](/image/14.gif)

![](/image/15.gif)

因为我独创的渲染机制非常唐，导致一个周期只能渲染除了背景外的20多个32*32像素图形。要想渲染更多就得提高行缓冲的频率，把原来的16行换成8行后，交换速度跟不上了，屏幕开始平移。

好在最后试了试12行缓冲能成功
### 开始整合
![](/image/16.gif)

到这里只剩一周多的时间了，开始把所有模块综合起来，结果小粪变成大粪了。

小人不听话转圈，而且渲染有严重问题，背景残影没有消除。（后来也是在毛概课上仿真发现了一个唐氏错误）

![](/image/17.gif)

这时候运动模块也是依托

![](/image/18.gif)

渲染逻辑也有大问题，小人移动有尾气我真没绷住

![](/image/23.jpg)

![](/image/24.gif)

![](/image/22.jpg)

最搞的是间歇性出现绿色特效，行走的毛笔。后来发现大概是时序有点爆炸了，甚至每次综合出来的问题都是随机的...


![](/image/19.gif)

而且小人移动的时候会破坏背景，这是我找的最艰难的一个bug,最后发现是SDRAM需要8字节对齐，我一直不知道这个限制，以为能任意地址读取。

![](/image/20.gif)

大概还剩不到一周的时间，才把显存的所有bug修完。还剩不到一周，但是运动模块、AI模块全都没怎么写，压力山大

### 决战阶段
![](/image/21.gif)

给小人加脚底的标志

![](/image/25.jpg)

因为我坐在最后一排，可以轻易视奸前面组的游戏（）

正前方是czt的蔚蓝，左前是zxl的paradox,我左边是jtl和lz的森林冰火人（我承认我经常趁他俩不在的时候把玩）

![](/image/26.jpg)

最后开始写AI的时候，大概只剩三四天了。熬到5点回宿舍，睡到10点起来吃饭然后继续去实验室，太折磨了。

而且因为我暴力的代码逻辑，直接把FPGA的LUT用完了（基本全是ai模块用的），wtf? 后来史诗级优化才压下去。

![](/image/27.gif)

写了一个草履虫级别的决策树，小人也是糖的每边了。最后又优化了一下总算比较像人类了（

### 最后一夜
最后一夜，我增加了最后几个功能：球网约束和计分，然而一直有bug。
而且因为时序不收敛，我综合出来的东西会有概率出bug.

到这里已经几乎没有时间了，当我被这个“不知道是不是最后一个”的bug困扰了许久时，脑海里开始萦绕《赌博默示录》的片尾曲台词。我开始怀疑，自己会不会倒在最后一步，成为“败犬”。

然而，一切比我想要的顺利——或者说，相比之前最艰难的那段时光要顺利。

当综合出来的最后一个版本一切都完美无缺时，感觉周围的一切都变得很不真实，像梦一样。起身离开这个陪伴我一个多月的位置，离开这个带给我无数快乐和痛苦的实验室，心里想着：今天终于能做个好梦了吧.

![](/image/28.jpg)

![](/image/29.jpg)

![](/image/30.gif)



